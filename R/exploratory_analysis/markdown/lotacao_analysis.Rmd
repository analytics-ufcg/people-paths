---
title: "new_report"
author: "José Ivan Silva da Cruz Júnior"
date: "3/10/2020"
output: html_document
---

```{r}
library(dplyr)
library(tidyverse)
library(geosphere)
library(magrittr)
library(ggplot2)

library(rgeos)
library(sp)
library(rgdal)

options(scipen = 999)
options(warn=-1)
```

#leitura dos datasets
```{r}
estimated_trips_result <- read_csv("/local/juninho/aggregate_output/output2/result.csv", col_types = list(
    date = col_date(format = ""),
    week_day = col_double(),
    route = col_character(),
    start_hour = col_double(),
    quantity_trips = col_double(),
    duration_median = col_double(),
    dist_median = col_double()
  )
)

ant_data <- read.csv("/local/juninho/aggregate_output/output2/result.csv", stringsAsFactors=F)
```

```{r}
tdata <- ant_data %>% 
  mutate(from_hour = lubridate::hour(lubridate::ymd_hms(start_time))) %>% 
  mutate(from_minute = lubridate::minute(lubridate::ymd_hms(start_time))) %>% 
  mutate(end_hour = lubridate::hour(lubridate::ymd_hms(end_time))) %>% 
  mutate(end_minute = lubridate::minute(lubridate::ymd_hms(end_time)))

tdata

```

```{r}
full_data <- read_csv("/local/juninho/aggregate_output/output2/result.csv")

full_data


rotas <- full_data %>% 
  filter(date == "2017-05-02" & route == "203" & (from_hour >= 6 & end_hour <= 7)) %>%
  group_by(route, busCode, from_hour) %>% 
  summarise(trips_bus = sum(quantity_trips)) %>% 
  filter(trips_bus >= 80) %>%
  top_n(10) %>% 
  ggplot(aes(x = reorder(busCode, -trips_bus), y = trips_bus)) + geom_col() + labs(x = "ônibus", y = "quantidade de viagens")

# número de ônibus - 43
# número de õnivus com mais de 80 pessoas - 14 
# 33% dos ônibus lotados
rotas
```

