---
title: "new_report"
author: "José Ivan Silva da Cruz Júnior"
date: "21/07/2020"
output: html_document
---

```{r}
library(dplyr)
library(tidyverse)
library(geosphere)
library(magrittr)
library(ggplot2)

library(rgeos)
library(sp)
library(rgdal)

options(scipen = 999)
options(warn=-1)
```

```{r}
final_data <- read.csv("/local/juninho/aggregate_output/output2/result.csv", stringsAsFactors=F)

final_data <- final_data %>% 
  mutate(from_hour = lubridate::hour(lubridate::hms(from_time)))
```

```{r}
final_data %>%
  ggplot(aes(x = dist_median, y = duration_median)) + 
  geom_point(size = .5, alpha = .5) + theme_classic()  + 
  geom_smooth(method = "lm") + labs(x = "Distância percorrida", y = "Duração")
```
```{r}
final_data %>%
   filter((dist_median < 6000 & duration_median > 50) | (dist_median < 20000 & duration_median > 60)) %>% 
  ggplot(aes(x = dist_median, y = duration_median)) + geom_point()

outliers <- final_data %>%
  filter((dist_median < 6000 & duration_median > 50) | (dist_median < 20000 & duration_median > 60))

outliers
```

Outliers por dia
```{r}
outliers %>% 
  group_by(week_day) %>%
  summarise(day_outliers = n()) %>% 
  ggplot(aes(x = week_day, y = day_outliers)) + geom_col() + theme_bw() + labs(x = "Dia da semana", y = "Quantidade de viagens")
  
```

Outliers por rota escolhendo o dia
```{r}
outliers %>%
  filter(week_day == "3") %>% 
  group_by(route) %>%
  summarise(day_outliers = n()) %>% 
  filter(day_outliers > 40) %>% 
  ggplot(aes(x = factor(route), y = day_outliers)) + geom_col() + theme_bw() + labs(x = "Rota", y = "Quantidade de viagens")
  
```

Otliers por dia escolhendo a rota
```{r}
outliers %>%
  filter(route == "370") %>% 
  group_by(route, week_day) %>%
  summarise(day_outliers = n()) %>% 
  ggplot(aes(x = week_day, y = day_outliers)) + geom_col() + theme_bw() + labs(x = "Dia da semana", y = "Quantidade de viagens")
```
